[Unit]
Description=OpenClaw Docker Compose Service
Requires=docker.service
After=docker.service network-online.target
Wants=network-online.target

[Service]
Type=oneshot
RemainAfterExit=yes
WorkingDirectory=/opt/openclaw
ExecStartPre=/bin/sh -lc 'aws ecr get-login-password --region {{ aws_region }} | docker login --username AWS --password-stdin {{ ecr_registry_domain }}'
ExecStartPre=/usr/local/lib/docker/cli-plugins/docker-compose -f /opt/openclaw/docker-compose.yaml --env-file /opt/openclaw/.env pull
ExecStart=/usr/local/lib/docker/cli-plugins/docker-compose -f /opt/openclaw/docker-compose.yaml --env-file /opt/openclaw/.env up -d
ExecStop=/usr/local/lib/docker/cli-plugins/docker-compose -f /opt/openclaw/docker-compose.yaml --env-file /opt/openclaw/.env down

User=ec2-user
Group=docker

[Install]
WantedBy=multi-user.target
